<a *ngIf="pageAsDemo" href="https://github.com/nie-ine/NIE-OS.git" class="github-corner" aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>

<app-load-variables
  (sendPageBack)="receivePage( $event )"
  (sendOpenAppsInThisPageBack)="receiveOpenAppsInThisPage( $event )"
  [reload]="reloadVariables">

</app-load-variables>

  <app-data-assignment
    [index]="index"
    [openAppsInThisPage]="openAppsInThisPage"
    [appInputQueryMapping]="page.appInputQueryMapping"
    [response]="response"
    [queryId] = "queryId"
    [depth]="depth"
    [pathWithArray]="pathWithArray"
    (sendAppTypesBackToNIEOS)="receiveOpenAppsInThisPage( $event )">

  </app-data-assignment>


<ngx-spinner
  bdColor = "rgba(51, 51, 51, 0.8)"
  size = "large"
  color = "#fff"
  type = "cube-transition"
></ngx-spinner>

      <!-- pageMenu -->
      <div *ngFor="let createResourceForm of openAppsInThisPage[ 'pageMenu' ].model; let i = index;" >
        <popup #pageMenu
               [fullWidth]="openAppsInThisPage[ 'pageMenu' ].model[i].fullWidth"
               [fullHeight]="openAppsInThisPage[ 'pageMenu' ].model[i].fullHeight"
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="openAppsInThisPage[ 'pageMenu' ].model[i].hash"
               [title]="'Inseri Lighthouse App Shore '"
               [type]="openAppsInThisPage[ 'pageMenu' ].type"
               [firstPopupX]="openAppsInThisPage[ 'pageMenu' ].model[i].x"
               [firstPopupY]="openAppsInThisPage[ 'pageMenu' ].model[i].y"
               [width]="produceHeightAndWidth( openAppsInThisPage[ 'pageMenu' ].model[i].width, '600' )"
               [height]="produceHeightAndWidth( openAppsInThisPage[ 'pageMenu' ].model[i].height, '600')"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)">
          <div [ngStyle]="{'height': openAppsInThisPage[ 'pageMenu' ].model[i].fullHeight ? '100%' : produceHeightAndWidth( openAppsInThisPage[ 'pageMenu' ].model[i].height, '600' ) + 'px',
              'width': openAppsInThisPage[ 'pageMenu' ].model[i].fullWidth ? '100%' : produceHeightAndWidth( openAppsInThisPage[ 'pageMenu' ].model[i].width, '600' ) + 'px'}">

            <div *ngIf="pageAsDemo">
              <h4>Tutorial Videos</h4>
              <button mat-button color="primary" (click)="addVideoApp( 'https://www.youtube.com/embed/9An1cGPrv9Q' )"> <mat-icon>video_library</mat-icon> Watch Video "First steps in Inseri"</button>
              <h4 style="margin-top: 15px;" >Apps</h4>
            </div>

            <mat-form-field style="width: 100%">
              <input matInput (keyup)="applyFilter($event.target.value)" placeholder="Filter">
            </mat-form-field>

            <div style="width: 100%">
              <table mat-table [dataSource]="dataSource" matSort>

                <!-- ID Column -->
                <ng-container matColumnDef="id"  >
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Icon </th>
                  <td mat-cell *matCellDef="let row" (click)="addAnotherApp(row.appType, true)" style="cursor: pointer; width: 25%;"> <mat-icon>{{row.id}}</mat-icon> </td>
                </ng-container>

                <!-- Tag Column -->
                <ng-container matColumnDef="tags"  >
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Tags </th>
                  <td mat-cell *matCellDef="let row" (click)="addAnotherApp(row.appType, true)" style="cursor: pointer; width: 25%;"> {{row.tags}} </td>
                </ng-container>

                <!-- Name Column -->
                <ng-container matColumnDef="name" >
                  <th mat-header-cell *matHeaderCellDef mat-sort-header > Name </th>
                  <td mat-cell *matCellDef="let row"
                      (click)="addAnotherApp(row.appType, true)"
                      style="cursor: pointer; width: 25%;" > {{row.name}} </td>
                </ng-container>

                <!-- Color Column -->
                <ng-container matColumnDef="status"  >
                  <th mat-header-cell *matHeaderCellDef mat-sort-header> Status </th>
                  <td mat-cell *matCellDef="let row" [style.color]="row.color" (click)="addAnotherApp(row.appType, true)" style="cursor: pointer; width: 25%;" matTooltip="{{row.description}}"> {{row.status}} </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedColumns" style="width: 100%;"></tr>
                <tr mat-row *matRowDef="let row; columns: displayedColumns;" style="width: 100%;"></tr>
              </table>

              <mat-paginator [pageSizeOptions]="[5, 10, 25, 100]"></mat-paginator>
            </div>
          </div>
        </popup>
      </div>


      <!-- Publish Option Expansion Panel -->
      <div style="vertical-align: bottom; ">
        <button type="button" mat-button (click)="openPageMenu()" *ngIf="!preview || showInseriLogoOnPublish" style="margin-top: 15px;">
          <img [src]=" lightHouse ?  '../../../../assets/img/logo_transparent.png' : '../../../../assets/img/logo_transparent2.png'" style="width: 40px; margin-bottom: 2px; vertical-align: bottom;" matTooltip="inseri apps" >
        </button>


        <button *ngIf="pagesOfThisActtion"
          [disabled]="selectedPage === 0"
          mat-button
          (click)="selectPage( selectedPage - 1 , pagesOfThisActtion[ selectedPage - 1 ] )">
          <mat-icon> keyboard_arrow_left </mat-icon>
        </button>
        <button mat-button [matMenuTriggerFor]="menu3" *ngIf="pagesOfThisActtion">{{
          page.title }}
        </button>
        <mat-menu #menu3="matMenu" >
          <button
            style="display: block"
            [color]=" checkIfSelected( i ) ? 'primary' : 'null'"
            *ngFor="let page of pagesOfThisActtion; let i = index;"
            matTooltip="{{ page.description }}"
            mat-button
            (click)="selectPage( i, page )">{{ page.title }}</button>
          <button
            *ngIf=" (!pageAsDemo) && !preview && loggedIn" mat-button
            (click)="addNewPage()" matTooltip="'add new page tho this pageSet'"><mat-icon>add</mat-icon></button>
        </mat-menu>
        <button [disabled]="selectedPage === pagesOfThisActtion.length - 1"
                *ngIf="pagesOfThisActtion"
                mat-button
                (click)="selectPage( selectedPage + 1 , pagesOfThisActtion[ selectedPage + 1 ] )">
          <mat-icon > keyboard_arrow_right </mat-icon>
        </button>

<!--        <div style=" width: 70%; overflow-x: auto; overflow-y: hidden; display: inline-block; position: relative; white-space: nowrap; margin-right: 15px; margin-top: 8px; vertical-align: top;" >-->
<!--          <mat-chip-list *ngFor="let page of pagesOfThisActtion; let i = index;" style=" margin-left: 15px; display: inline-block; ">-->
<!--            <mat-chip matTooltip="{{ page.description }}" selected [color]="'primary'"  *ngIf="checkIfSelected( i )" style="cursor: pointer; display: inline-block;">-->
<!--              {{ page.title }}-->
<!--            </mat-chip>-->
<!--            <mat-chip matTooltip="{{ page.description }}" *ngIf="!checkIfSelected( i )" (click)="selectPage( i, page )" style="cursor: pointer; display: inline-block;">-->
<!--              {{ page.title }}-->
<!--            </mat-chip>-->
<!--            <mat-chip style="cursor: pointer; margin-left: 15px;" *ngIf=" (!pageAsDemo) && !preview && route.snapshot.queryParams.page && i === pagesOfThisActtion.length -1">-->
<!--              <mat-icon (click)="addNewPage()" matTooltip="'add new page tho this pageSet'">-->
<!--                add-->
<!--              </mat-icon>-->
<!--            </mat-chip>-->
<!--          </mat-chip-list>-->
<!--        </div>-->


        <button mat-button *ngIf="pageIsPublished && loggedIn" matTooltip='Page is published' style="float: right; margin-top: 4px; "  ><mat-icon>public</mat-icon></button>
        <button mat-button *ngIf=" (!pageAsDemo) && !preview && loggedIn" matTooltip='Preview of published page' style="float: right; margin-top: 4px;" (click)="preview = !preview" ><mat-icon>nature_people</mat-icon></button>
        <button mat-button *ngIf=" (!pageAsDemo) && preview && loggedIn" matTooltip='Back to page editor' style=" cursor: pointer; float: right; margin-top: 4px;" (click)="preview = !preview" ><mat-icon>nature</mat-icon></button>
        <button mat-button [matMenuTriggerFor]="menu1" *ngIf=" (!pageAsDemo) && !preview" style="float: right; margin-top: 4px;"><mat-icon>settings</mat-icon></button>
        <mat-menu #menu1="matMenu">
          <button mat-menu-item (click)="goToDashBoard()" *ngIf=" (!pageAsDemo) && !preview">
            <mat-icon matTooltip="back to dashboard">home</mat-icon> Dashboard
          </button>
          <button mat-menu-item (click)="goToPageSet()" *ngIf="route.snapshot.queryParams.page" >
            <mat-icon matTooltip="document index">list</mat-icon> Document index
          </button>
          <button mat-menu-item *ngIf=" (!pageAsDemo) && !preview" (click)="updatePage()" >
            <mat-icon  matTooltip="save page">save</mat-icon> Save Page
          </button>
          <button mat-menu-item *ngIf=" (!pageAsDemo) && !preview" (click)="openDataManagement()" >
            <mat-icon matTooltip="page data manager">zoom_out_map</mat-icon> Data management
          </button>
          <button mat-menu-item *ngIf=" (!pageAsDemo) && !preview" (click)="logout()" >
            <mat-icon matTooltip="{{ 'click to logout - ' + userInfo }}">lock_open</mat-icon> Log out
          </button>
        </mat-menu>
        <div style=" position: fixed; bottom: 0; left: 0; z-index: 200; overflow-x: auto; margin-top: 70px; width: 300px;" *ngIf="preview && loggedIn">
          <mat-expansion-panel [ngStyle]="{
          'height': publishedOptionsExpanded ? '500px' : '',
          'overflow': publishedOptionsExpanded ? 'auto' : '' }" >
            <mat-expansion-panel-header (click)="publishedOptionsExpanded = !publishedOptionsExpanded">
              <mat-panel-title>
                Publish Options
              </mat-panel-title>
            </mat-expansion-panel-header>

            <mat-checkbox [(ngModel)]="showAppTitlesOnPublish" (click)="updatePagePublishSettings()">Show app title bar</mat-checkbox> - This enables the user to reorganise the published page for his own purpose, for example to minimize some apps etc.
            Changes of a user are dismissed after the user leaves the published page. <br>
            <mat-checkbox [disabled]="!showAppTitlesOnPublish" [(ngModel)]="showAppSettingsOnPublish" (click)="updatePagePublishSettings()">Show app settings</mat-checkbox> - This enables the user to minimize apps and change app sizes.
            <mat-divider style="margin-top: 10px; margin-bottom: 10px;" ></mat-divider>
            <mat-checkbox [(ngModel)]="showInseriLogoOnPublish" (click)="updatePagePublishSettings()">Show Inseri Appshore Button</mat-checkbox> - This option enables users of the page to open apps on your published page. It enables users for example to insert own, non - public comments on your page as well as
            open other apps that only the respective user can see, for example to write an own, non public essay with a text - editor - app.
            <mat-divider style="margin-top: 10px; margin-bottom: 10px;"  ></mat-divider>
            <mat-checkbox  [(ngModel)]="showDataBrowserOnPublish" (click)="updatePagePublishSettings()">Show Data Browser</mat-checkbox> - This option enables users of the page to possibly browse through the data of the page, if you mapped an array from the json to an app input.
            <mat-divider style="margin-top: 10px; margin-bottom: 10px;"  ></mat-divider>
            <mat-radio-group aria-label="Select an option">
              <mat-radio-button value="1" [checked]="true" >Beta Publication</mat-radio-button> - This inseri publication type indicates for a user that the page can still be changed by the user after the page has been published. Thus,
              the page is not quotable and can not be used as a reference for scientific publications. <br>
              <mat-radio-button value="2" [disabled]="true" >Alpha Publication</mat-radio-button> - This inseri publication type indicates that the page, once it is published, is persistent and can't be changed by anyone ever again.
              Thus, the page is quotable and can be used as a reference for scientific publications.
            </mat-radio-group>
            <mat-divider style="margin-top: 10px; margin-bottom: 10px;"  ></mat-divider>
            <button mat-button *ngIf="!pageIsPublished" (click)="publishPageOrMakePagePrivate( true )"> <mat-icon>publish</mat-icon> Publish Page</button>
            <button mat-button *ngIf="pageIsPublished" (click)="publishPageOrMakePagePrivate( false )"> <mat-icon>fingerprint</mat-icon> Make page private again</button>
          </mat-expansion-panel>
        </div>


    <!-- Data Chooser -->
  <div style=" position: fixed; bottom: 0; right: 0; z-index: 200; overflow-x: auto; margin-top: 70px;"
       *ngIf="openAppsInThisPage[ 'dataChooser' ].model.length > 0 ">
    <mat-expansion-panel style="float: right;" [disabled]="preview && !showDataBrowserOnPublish" [ngStyle]="{ 'width': !(preview && !showDataBrowserOnPublish) ? '300px' : '0px'}">
      <mat-expansion-panel-header>
        <mat-panel-title>
          Data Browser
        </mat-panel-title>
      </mat-expansion-panel-header>
      <div *ngFor="let dataChooser of openAppsInThisPage[ 'dataChooser' ].model; let i = index;" >
        <div *ngIf="generateQueryAppPathInformation( openAppsInThisPage[ 'dataChooser' ].model[i].queryId ) !== undefined" >
          <button
            *ngIf=" openAppsInThisPage[ 'dataChooser' ].model[i].title && openAppsInThisPage[ 'dataChooser' ].model[i].title.search( 'Query: ' ) !== -1 "
            (click)="openQueryInformationDialog( openAppsInThisPage[ 'dataChooser' ].model[i].queryId )"
            mat-button matTooltip="{{openAppsInThisPage[ 'dataChooser' ].model[i].title}}" >
            {{ openAppsInThisPage[ 'dataChooser' ].model[i].title }}
          </button>
          <app-data-chooser
            [page]="page"
            [response]="openAppsInThisPage[ 'dataChooser' ].model[i].response"
            [queryId] = "openAppsInThisPage[ 'dataChooser' ].model[i].queryId"
            [openAppsInThisPage] = "openAppsInThisPage"
            [dataChooserEntries]="openAppsInThisPage[ 'dataChooser' ].model[i].dataChooserEntries"
            [description]=" openAppsInThisPage[ 'dataChooser' ].model[i].depth "
            [depth]="openAppsInThisPage[ 'dataChooser' ].model[i].depth"
            [pathWithArray]="openAppsInThisPage[ 'dataChooser' ].model[i].pathWithArray"
            (sendIndexBack)="updateMainResourceIndex( $event )">
          </app-data-chooser>
        </div>
      </div>
    </mat-expansion-panel>
  </div>


      <div *ngFor="let app of openAppArray; let i = index;" >
        <div *ngIf="( !preview || showAppSettingsOnPublish ) && innerWidth > 1000 && app.type !== 'pageMenu'">
          <button mat-button [matMenuTriggerFor]="menu" style="vertical-align: bottom;" ><mat-icon>{{ openApps.openApps[ app.type ].materialIcon }}</mat-icon> {{ i }}</button>
          <mat-menu #menu="matMenu" >
            <button mat-menu-item (click)="appId.appear()" (click)="app.initialized = true">Show {{ app.title || app.type  + i }}</button>
            <button mat-menu-item (click)=" closeApp( app.hash, i ) ">Remove this app</button>
          </mat-menu>
        </div>
        <popup #appId *ngIf="innerWidth > 1000 && app.type !== 'pageMenu'"
               [response]="app.response"
               [app]="app"
               [pathsWithArrays]="app.pathsWithArrays"
               [showAppSettingsOnPublish]="!preview || showAppSettingsOnPublish"
               [preview]="preview && !showAppTitlesOnPublish"
               [fullWidth]="app.fullWidth"
               [fullHeight]="app.fullHeight"
               (sendTiledPositionBack) = "updateTiledPosition( $event )"
               [position]="appFramePosition"
               [hash]="app.hash"
               [title]="app.title || app.type  + i"
               [type]="app.type"
               [firstPopupX]="app.x"
               [firstPopupY]="app.y"
               [height]="produceHeightAndWidth( app.height,  app.initialHeight)"
               [width]="produceHeightAndWidth( app.width,  app.initialWidth )"
               (sendAppCoordinatesBack)="updateAppCoordinates($event)"
               (sendAppSettingsBack)="updateAppSettings($event)"
               (sendAssignInputCommandBack)="openAssignInputDialog($event)">
          <div  [ngStyle]="{
          'height': app.fullHeight ? '100%' : produceHeightAndWidth( app.height, app.initialHeight ) + 'px',
          'width': app.fullWidth ? '100%' : produceHeightAndWidth( app.width, app.initialWidth ) + 'px'}">

            <app-all-app-selectors [app]="app">

            </app-all-app-selectors>

          </div>
        </popup>
      </div>
</div>

<div *ngIf="innerWidth < 1000" >
  <mat-card *ngFor="let app of openAppArray; let i = index;" style="display: inline-block; margin-left: 10px; margin-bottom: 10px;" >
    <mat-card-header >
      <mat-card-subtitle>

        {{ app.title }}


      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>

      <app-all-app-selectors [app]="app">

      </app-all-app-selectors>

    </mat-card-content>
    <mat-card-actions>

      <popup #appId *ngIf="app.type !== 'pageMenu'"
             [response]="app.response"
             [app]="app"
             [pathsWithArrays]="app.pathsWithArrays"
             [showAppSettingsOnPublish]="!preview || showAppSettingsOnPublish"
             [preview]="preview && !showAppTitlesOnPublish"
             [fullWidth]="app.fullWidth"
             [fullHeight]="app.fullHeight"
             (sendTiledPositionBack) = "updateTiledPosition( $event )"
             [position]="'static'"
             [hash]="app.hash"
             [title]="app.title || app.type  + i"
             [type]="app.type"
             [firstPopupX]="app.x"
             [firstPopupY]="app.y"
             (sendAppCoordinatesBack)="updateAppCoordinates($event)"
             (sendAppSettingsBack)="updateAppSettings($event)"
             (sendAssignInputCommandBack)="openAssignInputDialog($event)">

      </popup>

    </mat-card-actions>
  </mat-card>
</div>
